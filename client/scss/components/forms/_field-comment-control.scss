$button-size: theme('spacing.5');
$button-space: theme('spacing.3');

.w-field__comment-button {
  $root: &;

  @include transition(opacity 0.2s ease);
  color: $color-teal;
  background: none;
  border: 0;
  padding: 0;
  top: 50%;
  inset-inline-end: 0;
  transform: translateY(-50%);
  margin-inline-start: 10px;
  position: absolute;
  visibility: hidden;
  opacity: 0;

  .icon {
    width: $button-size;
    height: $button-size;
    color: inherit;
  }

  // For devices without hover support, always show when comments are enabled.
  @media (hover: none) {
    .tab-content--comments-enabled & {
      visibility: visible;
      opacity: 1;
    }
  }

  // Hide by default, reveal on hover of parent, for devices supporting hover interaction
  @media (hover: hover) {
    .tab-content--comments-enabled .w-field__input:hover > &,
    .tab-content--comments-enabled .w-field__input:focus-within > &,
    &:hover,
    &:focus,
    &.w-field__comment-button--focused {
      visibility: visible;
      opacity: 1;
    }
  }

  // TODO: Chat with thibaud about this
  .tab-content--comments-enabled .chooser & {
    position: unset;
    opacity: 1;
    visibility: visible;
    inset-inline-end: 0;
    margin-inline-start: 0;
    transform: translateY(3px);
  }
}

// Hide chooser comments if they aren't commentable
//.w-field:not(&.w-field--commentable) .chooser .w-field__comment-button  {
//  display: none;
//}

.w-field--commentable {
  margin-inline-end: calc($button-size + $button-space);

  .w-field__input {
    padding-right: calc($button-size + $button-space);
  }

  // Allow comment buttons to be placed along side the field by display flex
  //.tab-content--comments-enabled & .w-field__input {
  //  display: flex;
  //  align-items: center;
  //}
  .w-field-row & {
    margin-inline-end: 0;
  }

  //@include media-breakpoint-up(sm) {
  //  // Partial offset to reduce the change in layout with/without comments.
  //  padding-inline-end: calc($button-size / 1.5);
  //}

  textarea ~ .w-field__comment-button,
  &.w-field--checkbox_select_multiple .w-field__comment-button,
  &.w-field--admin_tag_widget .w-field__comment-button {
    transform: translateY(0);
    top: 5px;
  }
}

.w-field__comment-button--add {
  .icon-comment-add,
  .icon-comment-add-reversed {
    display: none;
  }

  &:not(:hover) {
    .icon-comment-add {
      display: block;
    }
  }

  &:hover {
    cursor: pointer;

    .icon-comment-add-reversed {
      display: block;
    }
  }

  // Hide the "Add comment" button if itâ€™s preceded by a "Reveal comment" button.
  .w-field__comment-button--reveal + & {
    display: none;
  }
}

.w-field__comment-button--reveal {
  display: none;

  .tab-content--comments-enabled & {
    display: block;
  }
}
